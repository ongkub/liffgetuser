<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö LINE UID</title>
  <link rel="stylesheet" href="css/formstyle.css">
  <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <div class="circleTopLeft"></div>
  <div class="bottomRight">
    <div class="circleBottomRight"></div>
  </div>
  
  <div class="main-container">
    <div class="header">
      <h1>üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö UID</h1>
      <p>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô LINE ‡∏à‡∏≤‡∏Å UID</p>
    </div>
    
    <div class="card">
      <div class="input-group">
        <label for="uidInput">‡∏Å‡∏£‡∏≠‡∏Å LINE User ID</label>
        <div class="input-wrapper">
          <input 
            type="text" 
            id="uidInput" 
            placeholder="‡πÄ‡∏ä‡πà‡∏ô U1234567890abcdef1234567890abcdef"
            autocomplete="off"
          >
        </div>
        <div class="error-message" id="errorMessage">
          ‚ö†Ô∏è ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö UID ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ U ‡πÅ‡∏•‡∏∞‡∏°‡∏µ 33 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)
        </div>
      </div>
      
      <button class="btn btn-primary" id="checkBtn" onclick="checkUID()">
        ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö UID
      </button>
      
      <div class="loading" id="loading">
        <div class="spinner"></div>
        <div class="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
      </div>
      
      <div class="result-section" id="resultSection">
        <div class="profile-container">
          <img id="pictureUrl" class="profile-image" src="" alt="Profile Picture">
          <div class="profile-name" id="displayName">-</div>
          <div class="profile-uid" id="displayUid">-</div>
        </div>
        
        <button class="btn btn-secondary" id="sendLinkBtn" onclick="sendRewardLink()">
          üì§ ‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
        </button>
      </div>
      
      <div class="success-box" style="display: none;" id="successBox">
        <strong>‚úÖ ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢:</strong>
        ‡πÅ‡∏≠‡∏õ‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ Vercel Serverless Function ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏Å‡∏•‡∏≤‡∏á 
        Access Token ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà Server ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢‡πÉ‡∏ô Frontend
      </div>
    </div>
  </div>

  <script>
    // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î URL ‡∏Ç‡∏≠‡∏á Vercel API
    const API_ENDPOINT = '/api/line-proxy'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô URL Vercel ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡πâ‡∏≤ deploy ‡πÅ‡∏¢‡∏Å
    const REWARD_FORM_URL = 'https://your-reward-form.com/'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô URL ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    
    window.onload = function() {
      document.getElementById('successBox').style.display = 'block';
    }
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö UID
    function validateUID(uid) {
      const uidPattern = /^U[0-9a-f]{32}$/i;
      return uidPattern.test(uid);
    }
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö UID
    async function checkUID() {
      const uidInput = document.getElementById('uidInput');
      const errorMessage = document.getElementById('errorMessage');
      const loading = document.getElementById('loading');
      const resultSection = document.getElementById('resultSection');
      const checkBtn = document.getElementById('checkBtn');
      
      const uid = uidInput.value.trim();
      
      // ‡∏ã‡πà‡∏≠‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏î‡∏¥‡∏°
      resultSection.classList.remove('show');
      errorMessage.classList.remove('show');
      uidInput.classList.remove('error');
      
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö UID
      if (!validateUID(uid)) {
        uidInput.classList.add('error');
        errorMessage.classList.add('show');
        return;
      }
      
      // ‡πÅ‡∏™‡∏î‡∏á loading
      loading.classList.add('show');
      checkBtn.disabled = true;
      
      try {
        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Vercel API
        const response = await fetch(`${API_ENDPOINT}?action=get-profile&uid=${uid}`, {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || `API Error: ${response.status}`);
        }
        
        const data = await response.json();
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
        displayProfile(data.profile, uid);
        
      } catch (error) {
        console.error('Error fetching profile:', error);
        
        if (error.message.includes('404')) {
          alert('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ UID ‡∏ô‡∏µ‡πâ\n\n‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ:\n1. UID ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á\n2. ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢ Add Bot ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏≤ Bot\n3. Bot ‡∏ñ‡∏π‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Ñ‡πÇ‡∏î‡∏¢‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ');
        } else if (error.message.includes('401')) {
          alert('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Access Token ‡πÉ‡∏ô Vercel Environment Variables ‡πÅ‡∏•‡πâ‡∏ß');
        } else {
          alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
        }
      } finally {
        loading.classList.remove('show');
        checkBtn.disabled = false;
      }
    }
    
    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
    function displayProfile(profile, uid) {
      const pictureUrl = profile.pictureUrl || 'https://via.placeholder.com/150/0064ff/FFFFFF?text=No+Image';
      document.getElementById('pictureUrl').src = pictureUrl;
      document.getElementById('displayName').textContent = profile.displayName || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠';
      document.getElementById('displayUid').textContent = uid;
      
      document.getElementById('resultSection').classList.add('show');
    }
    
    // ‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
    async function sendRewardLink() {
      const uid = document.getElementById('uidInput').value.trim();
      const displayName = document.getElementById('displayName').textContent;
      
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
      const rewardFormUrl = `${REWARD_FORM_URL}?uid=${uid}`;
      
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á
      const messageText = `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞‡∏Ñ‡∏∏‡∏ì ${displayName}\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡πà‡∏∞\n${rewardFormUrl}`;
      
      try {
        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Vercel API
        const response = await fetch(`${API_ENDPOINT}?action=send-message`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            to: uid,
            message: messageText
          })
        });
        
        if (!response.ok) {
          throw new Error('Failed to send message');
        }
        
        alert('‚úÖ ‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
        
      } catch (error) {
        console.error('Error sending message:', error);
        
        // ‡∏ñ‡πâ‡∏≤‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        if (navigator.clipboard) {
          await navigator.clipboard.writeText(messageText);
          alert('üìã ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏î‡πâ\n\n‡πÑ‡∏î‡πâ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏Ñ‡∏•‡∏¥‡∏õ‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏•‡πâ‡∏ß\n‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥‡πÑ‡∏õ‡∏™‡πà‡∏á‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ');
        } else {
          prompt('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ:', messageText);
        }
      }
    }
    
    // Enter key support
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('uidInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          checkUID();
        }
      });
      
      // Real-time validation
      document.getElementById('uidInput').addEventListener('input', function() {
        const errorMessage = document.getElementById('errorMessage');
        if (errorMessage.classList.contains('show')) {
          errorMessage.classList.remove('show');
          this.classList.remove('error');
        }
      });
    });
  </script>
</body>
</html>
